import type { NextApiRequest, NextApiResponse } from "next";
import fs from "fs";
const fsPromises = fs.promises;

export default async function handler(
  req: NextApiRequest,
  res: NextApiResponse
) {
  const id = req.query.id as string;
  if (!id) {
    res.status(400).json({
      message: "No cape id provided",
    });
    return;
  } else {
    const capeJSON = JSON.parse(`{
      "SimpleEvieCape": "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"
    }
    `);
    // find the cape texture for the given id, the data looks like this:

    if (!capeJSON[id]) {
      res.status(404).json({
        message: "Cape not found",
      });
      return;
    }

    // read the base64 encoded cape texture
    const readCapeTexture: Buffer = Buffer.from(capeJSON[id], "base64");

    // if the cape texture is found, return it
    res.setHeader("Content-Type", "image/png");
    res.status(200).send(readCapeTexture);
  }
}
